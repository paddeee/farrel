<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="epe-networked">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>

    <iron-pages attr-for-selected="data-route" selected="{{route}}">

      <section data-route="login">
        <epe-login
          user-actions="[[userActions]]"
          user-store="[[userStore]]"></epe-login>
      </section>

      <section data-route="choose-option">
        <epe-choose-option></epe-choose-option>
      </section>

      <section data-route="import">

        <paper-drawer-panel id="paperDrawerPanel">
          <!-- Drawer Scroll Header Panel -->
          <paper-scroll-header-panel drawer fixed>

            <!-- Drawer Toolbar -->
            <paper-toolbar id="drawerToolbar">
              <span class="paper-font-title">Menu</span>
            </paper-toolbar>

            <!-- Drawer Content -->
            <paper-menu class="list" attr-for-selected="data-route" selected="{{importRoute}}" on-iron-select="onMenuSelect">
              <a data-route="import-parse" href="/import-parse">
                <iron-icon icon="home"></iron-icon>
                <span>Home</span>
              </a>

              <a data-route="import-users" href="/import-users">
                <iron-icon icon="info"></iron-icon>
                <span>Users</span>
              </a>

              <a data-route="import-contact" href="/import-contact">
                <iron-icon icon="mail"></iron-icon>
                <span>Contact</span>
              </a>
            </paper-menu>
          </paper-scroll-header-panel>

          <!-- Main Area -->
          <paper-scroll-header-panel main condenses keep-condensed-header>

            <!-- Main Toolbar -->
            <paper-toolbar id="mainToolbar" class="tall">
              <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>
              <span class="flex"></span>

              <!-- Toolbar icons -->
              <paper-icon-button icon="refresh"></paper-icon-button>
              <paper-icon-button icon="search"></paper-icon-button>

              <!-- Application name -->
              <div class="middle middle-container center horizontal layout">
                <div class="app-name">Operation Farrell</div>
              </div>

              <!-- Application sub title -->
              <div class="bottom bottom-container center horizontal layout">
                <div class="bottom-title paper-font-subhead">Electronic Presentation of Evidence</div>
              </div>

            </paper-toolbar>

            <!-- Main Content -->
            <div class="content">
              <iron-pages attr-for-selected="data-route" selected="{{importRoute}}">

                <section data-route="import-parse">

                  <paper-material class="card" elevation="1">
                    <epe-parse-spreadsheet
                      import-actions="[[importActions]]"
                      import-store="[[importStore]]"
                      packaged-app="[[packagedApp]]"
                      csv-type="Places"
                      csv-parser="[[csvParser]]">
                    </epe-parse-spreadsheet>
                  </paper-material>
                </section>

                <section data-route="import-users">
                  <paper-material class="card" elevation="1">
                    <h2 class="paper-font-display2">Users</h2>
                    <p>This is the users section</p>
                    <a href="/import-users/Paddy">Paddy</a>
                  </paper-material>
                </section>

                <section data-route="user-info">
                  <paper-material class="card" elevation="1">
                    <h2 class="paper-font-display2">
                      User:<span>{{params.name}}</span>
                    </h2>
                    <div>This is <span>{{params.name}}</span>'s section</div>
                  </paper-material>
                </section>

                <section data-route="import-contact">
                  <paper-material class="card" elevation="1">
                    <h2 class="paper-font-display2">Contact</h2>
                    <p>This is the contact section</p>
                  </paper-material>
                </section>

              </iron-pages>
            </div>
          </paper-scroll-header-panel>
        </paper-drawer-panel>
      </section>
    </iron-pages>

    <paper-toast id="UserToast" duration="3000">
      <h2><span>User Login:</span></h2>
      <div>
        <span>[[user.message]]</span>
      </div>
    </paper-toast>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'epe-networked',

    properties: {

      user: {
        type: Object,
        value: null
      },

      packagedApp: {
        type: Boolean,
        value: false
      },

      csvType: {
        type: String,
        value: ''
      },

      csvParser: {
        type: Object,
        value: null
      }
    },

    // Set up listeners when element is ready
    ready: function() {

      this.userStore.listen(function(user) {

        if (user.status === 'loggedin') {
          this.user = user;
          this.navigateToChooseOption();
        }

        this.displayUserMessage(user);

      }.bind(this));
    },

    // Display relevant message to user
    displayUserMessage: function(user) {

      this.$.UserToast.show();
    },

    // Navigate to the Choose Option
    navigateToChooseOption: function() {
      this.route = 'choose-option';
    }
  });
})();
</script>
